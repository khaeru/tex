\mode<presentation>

% Beamer internals: https://tex.stackexchange.com/a/50090/94986
\def\insertpresentationendframe{\inserttotalframenumber}
\makeatletter
\g@addto@macro{\appendix}{\immediate\write\@auxout{\string\@writefile{nav}{\noexpand\headcommand{\noexpand\def\noexpand\insertpresentationendframe{\the\c@framenumber}}}}}
\makeatother

% github.com/matze/mtheme
\usetheme{metropolis}

% override \metropolis@enablesectionpage to not apply for \section*
\makeatletter
\renewcommand{\metropolis@enablesectionpage}{
  \AtBeginSection[]{
    \ifbeamer@inframe
      \sectionpage
    \else
      \frame<*|handout:0>[plain,c,noframenumbering]{\sectionpage}
    \fi
  }
}
\makeatother

\metroset{
  progressbar = frametitle,
  sectionpage = progressbar,  % to activate the above
  block = fill,
  }

% IDSS colours
\definecolor{idssblue1}{RGB}{10,83,126}
\definecolor{idssblue2}{RGB}{31,118,170}
\definecolor{idssblue3}{RGB}{0,158,222}
\definecolor{idssgreen}{RGB}{172,201,54}
\definecolor{idssgray1}{RGB}{64,64,65}
\definecolor{idssgray2}{RGB}{109,109,109}
\definecolor{idssgray3}{RGB}{149,149,149}
\definecolor{idssgray4}{RGB}{235,235,235}

%\hypersetup{colorlinks, citecolor = , linkcolor = }

% Frame numbering is X / Y, where Y is the last frame *excluding* appendices
\setbeamertemplate{frame numbering}{
  \insertsectionhead\ {\bfseries \insertframenumber}/\insertpresentationendframe
}

\setbeamercolor{normal text}{fg=idssgray1,bg=idssgray4}

\setbeamercolor{alerted text}{fg=idssblue3}
\setbeamercolor{example text}{fg=idssgreen}
\setbeamerfont{alerted text}{series=\bfseries}

\titlegraphic{\hfill\includegraphics[height=3cm]{idss-0}}

\setbeamertemplate{title}{
  \parbox[b][3cm][b]{0.8\textwidth}{
  \raggedright%
  \linespread{1.0}%
  \inserttitle%
  \par%
  \vspace*{0.5em}
  }
}

% Move page number/section title further into the bottom right corner
% Identical to the metropolis default except sep=1mm
\setbeamertemplate{footline}{%
  \begin{beamercolorbox}[wd=\textwidth, sep=1mm]{footline}%
    \usebeamerfont{page number in head/foot}%
    \usebeamertemplate*{frame footer}
    \hfill%
    \usebeamertemplate*{frame numbering}
  \end{beamercolorbox}%
}

% \mode
% <handout>
%
% \setbeamercolor{normal text}{fg=idssgray1,bg=white}

\mode<all>
